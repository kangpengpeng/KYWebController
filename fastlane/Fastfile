desc 'ManagerLib è¯¥èˆªé“æ˜¯ç§æœ‰åº“ç»´æŠ¤æ›´æ–°å¿«é€Ÿä¸Šä¼ å·¥å…·'
lane :ManagerLib do |options|

# ç‰ˆæœ¬tag
tagName = options[:tag]
# spec æ–‡ä»¶å
targetSpecName = options[:spec]
# æäº¤è®°å½•æè¿°
commitMsg = options[:commit]

# 1. pod install
cocoapods(
clean: true,
podfile: "./Example/Podfile"
)

# 2. ä¸Šä¼ æ–‡ä»¶
git_add(path: ".")
git_commit(path: ".", message: "#{commitMsg}")
push_to_git_remote

# éªŒè¯tagæ˜¯å¦å­˜åœ¨,å¦‚æœå­˜åœ¨, åº”è¯¥åˆ é™¤æœ¬åœ°æ ‡ç­¾å’Œè¿œç¨‹æ ‡ç­¾
#if åˆ¤æ–­æ ‡ç­¾æ˜¯å¦å­˜åœ¨
#    æ‰§è¡Œåˆ é™¤æœ¬åœ°/è¿œç¨‹æ ‡ç­¾
#end
if git_tag_exists(tag: tagName)
    UI.message("å‘ç°tag:#{tagName} å·²ç»å­˜åœ¨, å³å°†æ‰§è¡Œ, åˆ é™¤åŠ¨ä½œ ğŸš€")
    delete_git_tag(tag:tagName)
    # æˆ–è€…ä½¿ç”¨ delete_git_tag(tag:tagName, isDL:true, isDR:true)
end

# 3. æ‰“æ ‡ç­¾ git tag å¹¶ä¸Šä¼  git push --tags
add_git_tag(
tag: tagName
)
push_git_tags

# 4. spec æ–‡ä»¶éªŒè¯ pod spec lint
pod_lib_lint(allow_warnings: true, sources: ["https://gitee.com/kangpp/kycomponent-spec.git"])
pod_push(path: "#{targetSpecName}.podspec", repo: "KYComponent", sources: ["https://gitee.com/kangpp/kycomponent-spec.git"], allow_warnings: true)

end
